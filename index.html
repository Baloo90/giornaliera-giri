<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Giornaliera Giri</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header class="appHeader">
    <div class="appTitle">Giornaliera Giri</div>
    <div class="appSub">Salvataggio locale • Test con WebIntoApp</div>
  </header>

  <nav class="tabs">
    <button class="tabBtn active" data-tab="tab-inserisci">Inserisci</button>
    <button class="tabBtn" data-tab="tab-giornata">Giornata</button>
  </nav>

  <main class="container">

    <!-- TAB 1: INSERISCI -->
    <section id="tab-inserisci" class="tabPanel active">
      <h2>Inserisci / Modifica giro</h2>

      <div class="card">
        <div class="row">
          <div class="field">
            <label for="insData">Data</label>
            <input id="insData" type="date" />
            <div class="hint" id="insWeekdayHint"></div>
          </div>

          <div class="field">
            <label for="insGiro">Giro</label>
            <select id="insGiro"></select>
            <div class="hint">Include anche eventuali “giri speciali” della giornata.</div>
          </div>
        </div>

        <div class="row">
          <div class="field">
            <label for="insOp1">Operatore 1</label>
            <input id="insOp1" type="text" placeholder="Nome e cognome" list="dlOperatori" autocomplete="off" />
          </div>
          <div class="field">
            <label for="insOp2">Operatore 2 (opzionale)</label>
            <input id="insOp2" type="text" placeholder="Nome e cognome" list="dlOperatori" autocomplete="off" />
          </div>
        </div>

        <div class="row">
          <div class="field">
            <label for="insT1">Targa 1</label>
            <input id="insT1" type="text" maxlength="7" placeholder="Es. AB123CD" />
          </div>
          <div class="field">
            <label for="insT2">Targa 2 (opzionale)</label>
            <input id="insT2" type="text" maxlength="7" placeholder="Es. AB123CD" />
          </div>
        </div>

        <div class="row">
          <div class="field">
            <label for="insMatOp1">Operatore 1 → Materiale</label>
            <select id="insMatOp1"></select>
            <div class="hint" id="insMatHint">Imposta Materiale 1/2 nella “Giornata” della stessa data.</div>
          </div>
          <div class="field">
            <label for="insMatOp2">Operatore 2 → Materiale</label>
            <select id="insMatOp2"></select>
            <div class="hint">Non viene selezionato automaticamente: lo decidi tu.</div>
          </div>
        </div>

        <div class="row">
          <div class="field">
            <label for="insNoteGiro">Note (del giro)</label>
            <textarea id="insNoteGiro" rows="3" placeholder="Note specifiche per questo giro..."></textarea>
          </div>
        </div>

        <div class="actions">
          <button class="btn primary" id="btnSalva">Salva</button>
          <button class="btn" id="btnPulisci">Pulisci</button>
          <button class="btn danger hidden" id="btnAnnullaModifica">Annulla modifica</button>
        </div>

        <div class="status" id="insStatus" role="status" aria-live="polite"></div>
      </div>

      <datalist id="dlOperatori"></datalist>
    </section>

    <!-- TAB 2: GIORNATA -->
    <section id="tab-giornata" class="tabPanel">
      <h2>Giornata</h2>

      <div class="card">
        <div class="row">
          <div class="field">
            <label for="giorData">Seleziona data</label>
            <input id="giorData" type="date" />
            <div class="hint" id="giorWeekday"></div>
          </div>

          <div class="field compact">
            <label>&nbsp;</label>
            <button class="btn primary" id="btnCarica">Carica</button>
          </div>
        </div>

        <div class="divider"></div>

        <div class="row">
          <div class="field">
            <label for="giorCerca">Cerca nella giornata</label>
            <input id="giorCerca" type="text" placeholder="Giro / Operatore / Targa / Note..." autocomplete="off" />
            <div class="hint">Filtra in tempo reale la tabella.</div>
          </div>

          <div class="field compact">
            <label>&nbsp;</label>
            <button class="btn" id="btnCopiaIeri">Copia da ieri</button>
          </div>

          <div class="field compact">
            <label>&nbsp;</label>
            <button class="btn" id="btnPdf">Esporta PDF</button>
          </div>
        </div>

        <!-- Backup / Import -->
        <div class="row">
          <div class="field compact">
            <label>&nbsp;</label>
            <button class="btn" id="btnBackup">Backup (JSON)</button>
          </div>
          <div class="field compact">
            <label>&nbsp;</label>
            <button class="btn" id="btnImport">Importa (JSON)</button>
          </div>
          <div class="field">
            <div class="hint">Consiglio: fai un backup ogni tanto. In WebIntoApp, “svuota cache” può cancellare i dati.</div>
          </div>
        </div>

        <input id="fileImport" type="file" accept="application/json,.json" style="display:none" />

        <div class="divider"></div>

        <div class="row">
          <div class="field">
            <label for="giorCapo">Caposquadra (di giornata)</label>
            <input id="giorCapo" type="text" placeholder="Es. Rodolfo Sellati" list="dlCaposquadra" autocomplete="off" />
            <div class="hint">Vale per tutti i giri della data selezionata.</div>
          </div>

          <div class="field compact">
            <label>&nbsp;</label>
            <button class="btn" id="btnSalvaCapo">Salva Caposquadra</button>
          </div>
        </div>

        <div class="divider"></div>

        <div class="row">
          <div class="field">
            <label for="giorMat1">Materiale 1 (obbligatorio)</label>
            <input id="giorMat1" type="text" placeholder="Es. Plastica" list="dlMateriali" autocomplete="off" />
            <div class="hint">Puoi scrivere libero o scegliere dall’elenco.</div>
          </div>
          <div class="field">
            <label for="giorMat2">Materiale 2 (opzionale)</label>
            <input id="giorMat2" type="text" placeholder="Es. Organico" list="dlMateriali" autocomplete="off" />
            <div class="hint">Se non serve, lascia vuoto.</div>
          </div>
        </div>

        <div class="row">
          <div class="field compact">
            <label>&nbsp;</label>
            <button class="btn" id="btnSalvaMateriali">Salva Materiali</button>
          </div>
          <div class="field">
            <div class="hint" id="giorMatHint"></div>
          </div>
        </div>

        <div class="divider"></div>

        <div class="row">
          <div class="field">
            <label for="giorNote">Note (di giornata)</label>
            <textarea id="giorNote" rows="2" placeholder="Note generali della giornata..."></textarea>
          </div>
          <div class="field compact">
            <label>&nbsp;</label>
            <button class="btn" id="btnSalvaNoteGiornata">Salva Note</button>
          </div>
        </div>

        <div class="divider"></div>

        <div class="row">
          <div class="field">
            <label for="giorGiroSpeciale">Aggiungi giro speciale (solo per questa giornata)</label>
            <input id="giorGiroSpeciale" type="text" placeholder="Es. Extra Ingombranti..." autocomplete="off" />
          </div>

          <div class="field compact">
            <label>&nbsp;</label>
            <button class="btn" id="btnAggiungiGiroSpeciale">Aggiungi</button>
          </div>
        </div>

        <div class="status" id="giorStatus" role="status" aria-live="polite"></div>
      </div>

      <div class="card">
        <div class="tableHeader">
          <div class="tableTitle">Elenco giri della giornata</div>
          <div class="tableHint">Lista completa + giri speciali. “Modifica” sempre disponibile.</div>
        </div>

        <div class="tableWrap">
          <table class="grid" id="tblGiornata">
            <thead>
              <tr>
                <th class="colGiro">Giro</th>
                <th>Operatori</th>
                <th>Furgoni (targhe)</th>
                <th>Ripartizione materiali</th>
                <th>Note giro</th>
                <th class="colAzioni">Azioni</th>
              </tr>
            </thead>
            <tbody id="tblBody"></tbody>
          </table>
        </div>
      </div>

      <datalist id="dlCaposquadra"></datalist>
      <datalist id="dlMateriali"></datalist>
    </section>

  </main>

  <footer class="appFooter">
    <span id="footerInfo"></span>
  </footer>

  <!-- PDF libs -->
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.8.2/dist/jspdf.plugin.autotable.min.js"></script>

  <script src="script.js"></script>
</body>
</html>
